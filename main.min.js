"use strict";window.addEventListener("DOMContentLoaded",(e=>{let t,o;console.log("%c Hey! 🌎🌍🌏","font-size: 16px; color: #91FD9F; font-weight: bold;"),console.log("%c Pshhht! You can find the coords here:","font-size: 16px; color: #91FD9F; font-weight: bold;"),console.log("%c https://ko-fi.com/gboucher 👁️👁️","font-size: 16px; color: #91FD9F; font-weight: bold;"),document.addEventListener("keydown",(e=>{e.ctrlKey&&["61","107","173","109","187","189"].includes(e.keyCode)&&e.preventDefault()})),document.addEventListener("wheel",(e=>{e.ctrlKey&&e.preventDefault()}),{passive:!1});let n,r=new rive.Layout({fit:rive.Fit.Contain,alignment:rive.Alignment.Center}),s=new rive.Rive({src:"./img/loading_kya.riv",canvas:document.getElementById("preloader"),autoplay:!0,layout:r,stateMachines:"State machine",onLoad:()=>{s.resizeDrawingSurfaceToCanvas(),t=s.stateMachineInputs("State machine"),o=t.find((e=>"isComplete"===e.name)),console.log(o)}}),c="OOO",i=0,a=0,l=0,d=0,u=9,m=0,p=0,y=!1,g=!1,h=document.querySelector(".preloader"),v=document.querySelector(".container"),f=0,L=0,b=0,S=0,C=1,w=document.querySelector(".timer"),T=document.querySelector(".nbOfRound"),M=document.querySelector(".play-btn"),$=document.querySelector(".guess"),k=document.querySelector(".distance"),E=document.querySelector(".countryFlag"),q=document.querySelector(".countryName"),x=document.querySelector(".distanceSection"),P=document.querySelector(".points"),H=document.querySelector(".pointBar"),D=document.querySelector(".next"),I=document.querySelector(".resultsBtn"),N=document.querySelector(".results"),j=document.querySelector(".game-modes"),F=document.querySelector(".game"),A=document.querySelector(".transition"),z=document.querySelector(".menu-burger"),B=document.querySelector(".fa-xmark"),R=document.querySelector(".current-mode"),O=document.querySelector(".guessDivPoints"),Z=document.querySelector(".guessDivPoints .total-points"),J=document.querySelector(".guessDivPoints .max-points"),Y=0,_=0,K="Normal",X=document.querySelector(".social-media-burger"),G=document.querySelector(".pb-normal"),U=document.querySelector(".pb-easy"),Q=document.querySelector(".pb-nmtz"),V=[],W=null,ee=null,te=null;function oe(e,t,o){let n=JSON.parse(localStorage.getItem("gameData"))||{};const r={score:e,time:o};n[t]=r,localStorage.setItem("gameData",JSON.stringify(n))}function ne(e){const t=JSON.parse(localStorage.getItem("gameData"));return t&&t[e]?t[e]:null}function re(e){return e.toUpperCase().replace(/./g,(e=>String.fromCodePoint(127397+e.charCodeAt())))}M.addEventListener("click",(function(e){const t=ne("Easy");U.innerHTML=t?`<i class="fa-solid fa-crown fa-xs"></i><span> ${t.score} points in ${t.time}</span>`:"",t?U.classList.add("record"):U.remove();const o=ne("Normal");G.innerHTML=o?`<i class="fa-solid fa-crown fa-xs"></i><span> ${o.score} points in ${o.time}</span>`:"",o?G.classList.add("record"):G.remove();const n=ne("NMTZ");Q.innerHTML=n?`<i class="fa-solid fa-crown fa-xs"></i><span> ${n.score} points in ${n.time}</span>`:"",n?Q.classList.add("record"):Q.remove(),document.querySelector(".home").remove(),window.scrollTo(0,0),document.body.style.overflow="hidden",j.style.display="block";let r=document.querySelector(".normal-btn"),s=document.querySelector(".nmtz-btn"),c=document.querySelector(".easy-btn");r.addEventListener("click",(e=>{u=10})),s.addEventListener("click",(e=>{u=13,y=!0})),c.addEventListener("click",(e=>{u=9,g=!0})),r.addEventListener("click",ce),c.addEventListener("click",ce),s.addEventListener("click",ce)})),I.addEventListener("click",(function(e){let t=0,o=0,n=0;console.log(V[5].mathTime);for(let e=0;e<5;e++)t+=V[5].mathTime.seconds[e],o+=V[5].mathTime.minutes[e],n+=V[5].mathTime.hours[e];o+=Math.floor(t/60),t%=60,n+=Math.floor(o/60),o%=60;let r=0;for(let e=0;e<V[0].points.length;e++)r+=V[0].points[e];const s=ne(K),c=s?s.score:null;let i=!1;c?r>c&&(i=!0,oe(r,K,`${ie(n)}:${ie(o)}:${ie(t)}`)):(i=!0,oe(r,K,`${ie(n)}:${ie(o)}:${ie(t)}`));const a=ne(K);console.log("Your current PB on "+K+" is: "),console.log(a),document.body.style.overflow="visible",A.classList.remove("activated"),v.classList.remove("activated"),v.style.height="fit-content",document.body.style.height="unset",setTimeout((()=>{A.classList.add("activated"),v.classList.add("activated")}),10),F.remove(),x.remove(),I.remove();const l=document.createElement("div");l.classList.add("results-box"),N.appendChild(l);const d=document.createElement("h1");d.classList.add("results-title"),d.innerHTML="Results:",l.appendChild(d);const u=document.createElement("div");u.classList.add("pb"),i?u.classList.add("new-record"):u.classList.add("pb"),u.innerHTML=""+(i?'<i class="fa-solid fa-crown"></i> New PB!':'<i class="fa-solid fa-crown"></i> Your PB is '+ne(K).score+" points"),i&&l.appendChild(u);const m=document.createElement("div");m.classList.add("resultsTime"),m.innerHTML=`Total Time: ${ie(n)}:${ie(o)}:${ie(t)}`,l.appendChild(m);for(let e=0;e<=4;e++){const t=document.createElement("div");t.classList.add("result-round",`round-${e}`);const o=document.createElement("div");o.classList.add("is-country-correct"),o.innerHTML=w(V[3].isCountryCorrect[e]),t.appendChild(o);const n=document.createElement("div");n.classList.add("time"),n.innerHTML=V[4].time[e],t.appendChild(n);const r=document.createElement("div");r.classList.add("flag"),se(V[2].country[e]).then((t=>{V[2].country[e]=t,r.classList.add("flag-icon-"+t,"flag-icon","countryFlag")})),t.appendChild(r);const s=document.createElement("div");s.classList.add("points"),s.innerHTML=V[0].points[e]+" Points",t.appendChild(s);const c=document.createElement("div");c.classList.add("distance"),c.innerHTML=V[1].distance[e],t.appendChild(c),l.appendChild(t)}const p=document.createElement("div");p.classList.add("resultsPoints"),p.innerHTML=`Total Points: ${r}/5000`,l.appendChild(p);const y=document.createElement("div");y.classList.add("resultsMode"),y.innerHTML=`${K} Mode`,l.appendChild(y),i||l.appendChild(u);const g=document.createElement("a");g.href="./",g.classList.add("btn-container");const h=document.createElement("button");h.classList.add("try-again-btn");const f=document.createElement("button"),L=document.createElement("i");L.classList.add("fa-solid","fa-clipboard"),f.classList.add("copy-btn");const b=document.createElement("span");b.textContent="Copy to Clipboard",f.appendChild(L),f.appendChild(b);const S=document.createElement("h3");S.textContent="Try again!",h.appendChild(S),g.appendChild(h);const C=document.createElement("div");function w(e){return e?"✅":"❌"}C.classList.add("buttons"),C.appendChild(f),C.appendChild(g),N.appendChild(C),f.addEventListener("click",(async()=>{const e=`🌍 Know Your Atlas (@KnowYourAtlasGame)\n        ${K} Mode - ${r}/5000 - ${(new Date).toDateString()}\n\n        ⏱️ Total Time: ${ie(n)}:${ie(o)}:${ie(t)} ⏱️\n\n        ${i?"New PB!":"Your PB is "+ne(K).score}\n        \n        ${w(V[3].isCountryCorrect[0])} ${re(V[2].country[0])}  ${V[4].time[0]} | ${V[1].distance[0]} | ${V[0].points[0]} Points\n        ${w(V[3].isCountryCorrect[1])} ${re(V[2].country[1])}  ${V[4].time[1]} | ${V[1].distance[1]} | ${V[0].points[1]} Points\n        ${w(V[3].isCountryCorrect[2])} ${re(V[2].country[2])}  ${V[4].time[2]} | ${V[1].distance[2]} | ${V[0].points[2]} Points\n        ${w(V[3].isCountryCorrect[3])} ${re(V[2].country[3])}  ${V[4].time[3]} | ${V[1].distance[3]} | ${V[0].points[3]} Points\n        ${w(V[3].isCountryCorrect[4])} ${re(V[2].country[4])}  ${V[4].time[4]} | ${V[1].distance[4]} | ${V[0].points[4]} Points\n        \n        https://knowyouratlas.com`;try{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t),b.innerHTML="Copied!"}catch(e){console.error("Error copying to clipboard:",e.message)}}))})),z.addEventListener("click",(function(e){X.classList.add("opened")})),B.addEventListener("click",(function(e){X.classList.remove("opened")}));const se=async e=>{const t=`https://restcountries.com/v3.1/alpha?codes=${e}`;try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return(await e.json())[0].cca2.toLowerCase()}catch(e){console.error("Error fetching countries:",e.message)}};function ce(e){v.style.margin=0,K=y?"NMTZ":g?"Easy":"Normal",R.innerHTML=`${K} Mode`,V=[{points:[]},{distance:[]},{country:[]},{isCountryCorrect:[]},{time:[]},{mathTime:{hours:[],minutes:[],seconds:[]}}],h.style.opacity="1",mapboxgl.accessToken="pk.eyJ1IjoiYWtpbGl5aCIsImEiOiJja2RzdHgyaTAwdXl3MnBsaXJreXVvOXUwIn0.6TuTIZ-EC67QJO-s6saNeA",j.remove(),F.style.display="block",F.style.visibility="hidden";const t=new mapboxgl.Map({container:"map",style:"mapbox://styles/akiliyh/cl9oektre002814vqobxlbexz",center:[i,a],zoom:u,projection:"mercator",pitch:0,bearing:0});!0!==g&&!0!==y||t.setStyle("mapbox://styles/akiliyh/cl9pdy42q00ns15l3f0kz8o46");const r=new mapboxgl.Map({container:"guessMap",style:"mapbox://styles/akiliyh/cl95rzm2v002j14qtctkjkslt",center:[0,0],zoom:2,projection:"mercator"});y||t.addControl(new mapboxgl.NavigationControl),r.dragRotate.disable(),B(),r.on("click",(e=>{console.log(e.lngLat),console.log(e.point),null!=r.getSource("point")?console.log(r.getSource("point").setData({type:"Point",coordinates:[e.lngLat.lng,e.lngLat.lat]})):(console.log(e.lngLat),console.log(e.lngLat.lng),r.addSource("point",{type:"geojson",data:{type:"Point",coordinates:[e.lngLat.lng,e.lngLat.lat]}}),r.addLayer({id:"point",source:"point",type:"circle",paint:{"circle-radius":10,"circle-color":"#0D3C5D","circle-opacity":.65,"circle-stroke-color":"#000023","circle-stroke-width":2}})),m=e.lngLat.lng,p=e.lngLat.lat,$.style.display="block"}));let s=document.querySelector(".change");s?.addEventListener("click",B),document.querySelector(".reset").addEventListener("click",(function(e){t.easeTo({center:[i,a],zoom:u,pitch:l,bearing:d,duration:4e3})}));let M=document.querySelector(".guessDiv"),A=document.querySelector(".guessDiv .mapboxgl-canvas-container.mapboxgl-interactive");function z(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function B(e){fetch("./geojson/map.geojson").then((function(e){return e.json()})).then((function(e){!function(e){null!=t.getSource("countriesIn")&&null!=t.getLayer("countriesIn")&&(t.removeLayer("countriesIn"),t.removeSource("countriesIn")),null!=t.getSource("countries")&&null!=t.getLayer("correct-country")&&(t.removeLayer("correct-country"),t.removeSource("countries"));for(let o=0;o<e.features.length;o++){W=e.features[o].geometry.coordinates,ee=e.features[o].properties.A3,console.log(e.features.length),console.log(e.features[o].geometry.coordinates),console.log(e.features[o].geometry.coordinates[0]),console.log(e.features[o].geometry.coordinates.length),console.log(e.features[o].geometry.type);for(let n=0;n<e.features[o].geometry.coordinates.length;n++){let r,l=turf.point([i,a]);r="MultiPolygon"==e.features[o].geometry.type?turf.multiPolygon([e.features[o].geometry.coordinates[n]]):turf.polygon([e.features[o].geometry.coordinates[n]]),te=r;let d=turf.booleanPointInPolygon(l,r);if(o==e.features.length-1&&n==e.features[o].geometry.coordinates.length-1&&0==d&&B(),c=e.features[o].properties.A3,1==d)return s(c),void(null==t.getSource("point")&&null==t.getLayer("point")&&t.on("load",(function(){t.addSource("point",{type:"geojson",data:m()}),t.addLayer({id:"point",source:"point",type:"circle",paint:{"circle-radius":10,"circle-color":"#28FF43","circle-stroke-color":"#000023","circle-stroke-width":2}})})))}}}(e)}));const s=async e=>{const t=`https://restcountries.com/v3.1/alpha?codes=${e}`;try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const o=await e.json();o&&o.length>0?(q.innerHTML=o[0].name.common,E.removeAttribute("class"),E.setAttribute("class","flag-icon-"+o[0].cca2.toLowerCase()+" flag-icon countryFlag")):console.error("No country data found.")}catch(e){console.error("Error fetching countries:",e.message)}};function m(){return{type:"Point",coordinates:[i,a]}}r.setCenter([0,0]),r.setZoom([2]),i=360*(Math.random()-.5),a=100*(Math.random()-.5),l=0,d=0,1!=g&&(d=z(0,360)),l=z(0,75),1==y&&(t.scrollZoom.disable(),t.dragRotate.disable(),t.dragPan.disable(),t.touchZoomRotate.disableRotation()),t.setCenter([i,a]),t.setPitch(l),t.setBearing(d),t.setZoom(u),t.setMinZoom(u-1),null!=t.getSource("point")&&console.log(t.getSource("point").setData(m())),null!=r.getSource("point")&&null!=r.getLayer("point")&&(r.removeLayer("point"),r.removeSource("point")),t.once("idle",(e=>{var r=document.createElement("div");r.innerHTML="Guess this location";var s=document.createElementNS("http://www.w3.org/2000/svg","svg"),c=s.namespaceURI,l=document.createElementNS(c,"path");s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("viewBox","0 0 448 512"),s.setAttribute("class","chevron"),l.setAttribute("d","M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"),l.setAttribute("fill","white"),s.appendChild(l),r.append(s),r.className="marker",new mapboxgl.Marker(r).setLngLat([i,a]).addTo(t);const d=t.queryTerrainElevation([i,a]);console.log(d),d<=0?B():(o.fire(),setTimeout((()=>{h.style.display="none",F.style.visibility="visible",M.style.visibility="visible",O.style.overflow="visible",w.style.display="block",clearInterval(n),n=setInterval((()=>{(S+=15)>1e3&&(S=0,b++),60==b&&(b=0,L++),60==L&&(L=0,f++),document.querySelector(".hour").innerText=ie(f),document.querySelector(".minute").innerText=ie(L),document.querySelector(".second").innerText=ie(b)}),10)}),1e3))}))}A.style.cursor="crosshair",r.on("mousedown",(e=>{A.style.cursor="grabbing"})),r.on("mouseup",(e=>{A.style.cursor="crosshair"})),$.addEventListener("click",(e=>{O.classList.add("guessed"),clearInterval(n),t.setMinZoom([1]),x.style.display="block",5===C?(D.style.display="none",I.style.display="block"):D.style.display="block",M.style.display="none",$.style.display="none",t.addSource("guessPoint",{type:"geojson",data:{type:"Point",coordinates:[m,p]}}),t.addLayer({id:"guessPoint",source:"guessPoint",type:"circle",paint:{"circle-radius":10,"circle-color":"#0D3C5D","circle-stroke-color":"#000023","circle-stroke-width":2}}),t.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[m,p],[i,a]]}}}),t.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"white","line-width":7}}),t.addSource("countries",{type:"vector",url:"mapbox://mapbox.country-boundaries-v1"}),t.addLayer({id:"correct-country",type:"fill",source:"countries","source-layer":"country_boundaries",paint:{"fill-color":"#28FF43","fill-opacity":.4}},"route"),t.setFilter("correct-country",["in","iso_3166_1_alpha_3",c]);let o=t.getSource("route")._options.data;console.log(o),console.log(W),console.log(ee),console.log(te);let r=turf.lineString([[m,p],[i,a]]),s=turf.point([m,p]),l=turf.booleanPointInPolygon(s,te);console.log(l);let d=turf.length(r);d*=1e3;var u=Math.trunc(d);d>=1e3?(d=Math.round(d/1e3*100)/100+" km",u=Math.round(u/1e3*100)/100,console.log(Math.exp(-u/2e3)),u=Math.round(u),H.value=1e3*Math.exp(-u/2e3),console.log(d),console.log(u)):(d=Math.round(d)+" m",console.log(d),console.log(u),H.value=1e3),H.value>999?H.classList.add("perfect"):H.classList.remove("perfect"),k.innerHTML=d,1==Math.round(H.value)?P.innerHTML=Math.round(H.value)+" pt":P.innerHTML=Math.round(H.value)+" pts";const g=new mapboxgl.LngLatBounds([m,p],[i,a]);1==y&&(t.scrollZoom.enable(),t.dragRotate.enable(),t.dragPan.enable(),t.touchZoomRotate.enableRotation()),g.extend([m,p]),g.extend([i,a]),t.fitBounds(g,{padding:200,bearing:0,pitch:0,duration:4e3}),_+=1e3,J.innerHTML=_,Y+=Math.round(H.value),Z.innerHTML=Y,V[0].points.push(Math.round(H.value)),V[1].distance.push(d),V[2].country.push(c),V[3].isCountryCorrect.push(l),V[4].time.push(ie(f)+":"+ie(L)+":"+ie(b)),V[5].mathTime.hours.push(f),V[5].mathTime.minutes.push(L),V[5].mathTime.seconds.push(b)})),D.addEventListener("click",(e=>{N.style.display="block",O.classList.remove("guessed"),M.style.visibility="hidden",O.style.overflow="hidden",C++,T.innerHTML=C,5===C&&(console.log(C),D.style.display="none"),w.style.display="none",f=0,L=0,b=0,S=0,document.querySelector(".hour").innerText="00",document.querySelector(".minute").innerText="00",document.querySelector(".second").innerText="00",o.fire(),F.style.visibility="hidden",h.style.display="block",t.removeLayer("guessPoint"),t.removeSource("guessPoint"),t.removeLayer("route"),t.removeSource("route"),x.style.display="none",D.style.display="none",M.style.display="block",B()}))}function ie(e){return e>9?e:`0${e}`}}));