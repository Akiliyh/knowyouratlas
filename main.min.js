"use strict";window.addEventListener("DOMContentLoaded",e=>{function t(){document.addEventListener("keydown",function(e){e.ctrlKey&&("61"==e.keyCode||"107"==e.keyCode||"173"==e.keyCode||"109"==e.keyCode||"187"==e.keyCode||"189"==e.keyCode)&&e.preventDefault()}),document.addEventListener("wheel",function(e){e.ctrlKey&&e.preventDefault()},{passive:!1})}t();let o,r,n=new rive.Layout({fit:rive.Fit.Contain,alignment:rive.Alignment.Center}),i=new rive.Rive({src:"./img/loading_kya.riv",canvas:document.getElementById("preloader"),autoplay:!0,layout:n,stateMachines:"State machine",onLoad(){i.resizeDrawingSurfaceToCanvas(),r=(o=i.stateMachineInputs("State machine")).find(e=>"isComplete"===e.name),console.log(r)}}),a="OOO",s=0,l=0,c=0,d=0,u=9,y=0,$=0,p=!1,m=!1,g=document.querySelector(".preloader"),v=document.querySelector(".container"),h=0,L=0,f=0,_=0,b=1,S=document.querySelector(".timer"),C=document.querySelector(".nbOfRound"),k,T=document.querySelector(".play-btn"),E=document.querySelector(".guess"),w=document.querySelector(".distance"),q=document.querySelector(".countryFlag"),M=document.querySelector(".countryName"),P=document.querySelector(".distanceSection"),x=document.querySelector(".points"),H=document.querySelector(".pointBar"),j=document.querySelector(".next"),D=document.querySelector(".resultsBtn"),A=document.querySelector(".results"),I=document.querySelector(".game-modes"),R=document.querySelector(".game"),z=document.querySelector(".transition"),F=document.querySelector(".menu-burger"),N=document.querySelector(".fa-xmark"),Z=document.querySelector(".current-mode"),B=document.querySelector(".guessDivPoints"),O=document.querySelector(".guessDivPoints .total-points"),J=document.querySelector(".guessDivPoints .max-points"),K=0,X=0,G="Normal",U=document.querySelector(".social-media-burger"),Y=[],Q=null,V=null,W=null;function ee(e){U.classList.add("opened")}function et(e){U.classList.remove("opened")}function eo(e){document.body.style.overflow="visible",z.classList.remove("activated"),v.classList.remove("activated"),v.style.height="fit-content",document.body.style.height="unset",setTimeout(()=>{z.classList.add("activated"),v.classList.add("activated")},10),R.remove(),P.remove(),D.remove();let t=document.createElement("div");t.classList.add("results-box"),A.appendChild(t);let o=document.createElement("h1");o.classList.add("results-title"),o.innerHTML="Results:",t.appendChild(o);let r=document.createElement("div");r.classList.add("resultsTime");let n=0,i=0,a=0;console.log(Y[5].mathTime);for(let s=0;s<5;s++)n+=Y[5].mathTime.seconds[s],i+=Y[5].mathTime.minutes[s],a+=Y[5].mathTime.hours[s];i+=Math.floor(n/60),n%=60,a+=Math.floor(i/60),i%=60,r.innerHTML=`Total Time: ${ey(a)}:${ey(i)}:${ey(n)}`,t.appendChild(r);for(let l=0;l<=4;l++){let c=document.createElement("div");c.classList.add("result-round",`round-${l}`);let d=document.createElement("div");d.classList.add("is-country-correct"),d.innerHTML=E(Y[3].isCountryCorrect[l]),c.appendChild(d);let u=document.createElement("div");u.classList.add("time"),u.innerHTML=Y[4].time[l],c.appendChild(u);let y=document.createElement("div");y.classList.add("flag"),en(Y[2].country[l]).then(e=>{Y[2].country[l]=e,y.classList.add("flag-icon-"+e,"flag-icon","countryFlag")}),c.appendChild(y);let $=document.createElement("div");$.classList.add("points"),$.innerHTML=Y[0].points[l]+" Points",c.appendChild($);let p=document.createElement("div");p.classList.add("distance"),p.innerHTML=Y[1].distance[l],c.appendChild(p),t.appendChild(c)}let m=document.createElement("div");m.classList.add("resultsPoints");let g=0;for(let h=0;h<Y[0].points.length;h++)g+=Y[0].points[h];m.innerHTML=`Total Points: ${g}/5000`,t.appendChild(m);let L=document.createElement("div");L.classList.add("resultsMode"),L.innerHTML=`${G} Mode`,t.appendChild(L);let f=document.createElement("a");f.href="./",f.classList.add("btn-container");let _=document.createElement("button");_.classList.add("try-again-btn");let b=document.createElement("button"),S=document.createElement("i");S.classList.add("fa-solid","fa-clipboard"),b.classList.add("copy-btn");let C=document.createElement("span");C.textContent="Copy to Clipboard",b.appendChild(S),b.appendChild(C);let k=document.createElement("h3");k.textContent="Try again!",_.appendChild(k),f.appendChild(_);let T=document.createElement("div");function E(e){return e?"✅":"❌"}T.classList.add("buttons"),T.appendChild(b),T.appendChild(f),A.appendChild(T),b.addEventListener("click",async()=>{let e=`🌍 Know Your Atlas (@KnowYourAtlasGame)
        ${G} Mode - ${g}/5000 - ${new Date().toDateString()}

        ⏱️ Total Time: ${ey(a)}:${ey(i)}:${ey(n)} ⏱️
        
        ${E(Y[3].isCountryCorrect[0])} ${er(Y[2].country[0])}  ${Y[4].time[0]} | ${Y[1].distance[0]} | ${Y[0].points[0]} Points
        ${E(Y[3].isCountryCorrect[1])} ${er(Y[2].country[1])}  ${Y[4].time[1]} | ${Y[1].distance[1]} | ${Y[0].points[1]} Points
        ${E(Y[3].isCountryCorrect[2])} ${er(Y[2].country[2])}  ${Y[4].time[2]} | ${Y[1].distance[2]} | ${Y[0].points[2]} Points
        ${E(Y[3].isCountryCorrect[3])} ${er(Y[2].country[3])}  ${Y[4].time[3]} | ${Y[1].distance[3]} | ${Y[0].points[3]} Points
        ${E(Y[3].isCountryCorrect[4])} ${er(Y[2].country[4])}  ${Y[4].time[4]} | ${Y[1].distance[4]} | ${Y[0].points[4]} Points
        
        https://knowyouratlas.com`;try{let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t),C.innerHTML="Copied!"}catch(o){console.error("Error copying to clipboard:",o.message)}})}function er(e){return e.toUpperCase().replace(/./g,e=>String.fromCodePoint(127397+e.charCodeAt()))}T.addEventListener("click",ei),D.addEventListener("click",eo),F.addEventListener("click",ee),N.addEventListener("click",et);let en=async e=>{let t=`https://restcountries.com/v3.1/alpha?codes=${e}`;try{let o=await fetch(t);if(!o.ok)throw Error(`HTTP error! Status: ${o.status}`);let r=await o.json();return r[0].cca2.toLowerCase()}catch(n){console.error("Error fetching countries:",n.message)}};function ei(e){document.querySelector(".home").remove(),window.scrollTo(0,0),document.body.style.overflow="hidden",I.style.display="block";let t=document.querySelector(".normal-btn"),o=document.querySelector(".nmtz-btn"),r=document.querySelector(".easy-btn");t.addEventListener("click",e=>{u=10}),o.addEventListener("click",e=>{u=13,p=!0}),r.addEventListener("click",e=>{u=9,m=!0}),t.addEventListener("click",ea),r.addEventListener("click",ea),o.addEventListener("click",ea)}function ea(e){v.style.margin=0,G=p?"NMTZ":m?"Easy":"Normal",Z.innerHTML=`${G} Mode`,Y=[{points:[]},{distance:[]},{country:[]},{isCountryCorrect:[]},{time:[]},{mathTime:{hours:[],minutes:[],seconds:[]}}],g.style.opacity="1",mapboxgl.accessToken="pk.eyJ1IjoiYWtpbGl5aCIsImEiOiJja2RzdHgyaTAwdXl3MnBsaXJreXVvOXUwIn0.6TuTIZ-EC67QJO-s6saNeA",I.remove(),R.style.display="block",R.style.visibility="hidden";let t=new mapboxgl.Map({container:"map",style:"mapbox://styles/akiliyh/cl9oektre002814vqobxlbexz",center:[s,l],zoom:u,projection:"mercator",pitch:0,bearing:0});(!0===m||!0===p)&&t.setStyle("mapbox://styles/akiliyh/cl9pdy42q00ns15l3f0kz8o46");let o=new mapboxgl.Map({container:"guessMap",style:"mapbox://styles/akiliyh/cl95rzm2v002j14qtctkjkslt",center:[0,0],zoom:2,projection:"mercator"});p||t.addControl(new mapboxgl.NavigationControl),o.dragRotate.disable(),S(),o.on("click",e=>{console.log(e.lngLat),console.log(e.point),void 0!=o.getSource("point")?console.log(o.getSource("point").setData({type:"Point",coordinates:[e.lngLat.lng,e.lngLat.lat]})):(console.log(e.lngLat),console.log(e.lngLat.lng),o.addSource("point",{type:"geojson",data:{type:"Point",coordinates:[e.lngLat.lng,e.lngLat.lat]}}),o.addLayer({id:"point",source:"point",type:"circle",paint:{"circle-radius":10,"circle-color":"#0D3C5D","circle-opacity":.65,"circle-stroke-color":"#000023","circle-stroke-width":2}})),y=e.lngLat.lng,$=e.lngLat.lat,E.style.display="block"});document.querySelector(".change")?.addEventListener("click",S);document.querySelector(".reset").addEventListener("click",function e(o){t.easeTo({center:[s,l],zoom:u,pitch:c,bearing:d,duration:4e3})});let n=document.querySelector(".guessDiv"),i=document.querySelector(".guessDiv .mapboxgl-canvas-container.mapboxgl-interactive");function _(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function S(e){console.clear(),fetch("./geojson/map.geojson").then(function(e){return e.json()}).then(function(e){!function e(o){void 0!=t.getSource("countriesIn")&&void 0!=t.getLayer("countriesIn")&&(t.removeLayer("countriesIn"),t.removeSource("countriesIn")),void 0!=t.getSource("countries")&&void 0!=t.getLayer("correct-country")&&(t.removeLayer("correct-country"),t.removeSource("countries"));for(let r=0;r<o.features.length;r++){Q=o.features[r].geometry.coordinates,V=o.features[r].properties.A3,console.log(o.features.length),console.log(o.features[r].geometry.coordinates),console.log(o.features[r].geometry.coordinates[0]),console.log(o.features[r].geometry.coordinates.length),console.log(o.features[r].geometry.type);for(let n=0;n<o.features[r].geometry.coordinates.length;n++){let c=turf.point([s,l]),d;W=d="MultiPolygon"==o.features[r].geometry.type?turf.multiPolygon([o.features[r].geometry.coordinates[n]]):turf.polygon([o.features[r].geometry.coordinates[n]]);let u=turf.booleanPointInPolygon(c,d);if(r==o.features.length-1&&n==o.features[r].geometry.coordinates.length-1&&!1==u&&S(),a=o.features[r].properties.A3,!0==u){i(a),void 0==t.getSource("point")&&void 0==t.getLayer("point")&&t.on("load",function(){t.addSource("point",{type:"geojson",data:y(0)}),t.addLayer({id:"point",source:"point",type:"circle",paint:{"circle-radius":10,"circle-color":"#28FF43","circle-stroke-color":"#000023","circle-stroke-width":2}})});return}}}}(e)});let i=async e=>{let t=`https://restcountries.com/v3.1/alpha?codes=${e}`;try{let o=await fetch(t);if(!o.ok)throw Error(`HTTP error! Status: ${o.status}`);let r=await o.json();r&&r.length>0?(M.innerHTML=r[0].name.common,q.removeAttribute("class"),q.setAttribute("class","flag-icon-"+r[0].cca2.toLowerCase()+" flag-icon countryFlag")):console.error("No country data found.")}catch(n){console.error("Error fetching countries:",n.message)}};function y(){return{type:"Point",coordinates:[s,l]}}o.setCenter([0,0]),o.setZoom([2]),s=(Math.random()-.5)*360,l=(Math.random()-.5)*100,c=0,d=0,!0!=m&&(d=_(0,360)),c=_(0,75),!0==p&&(t.scrollZoom.disable(),t.dragRotate.disable(),t.dragPan.disable(),t.touchZoomRotate.disableRotation()),t.setCenter([s,l]),t.setPitch(c),t.setBearing(d),t.setZoom(u),t.setMinZoom(u-1),void 0!=t.getSource("point")&&console.log(t.getSource("point").setData(y())),void 0!=o.getSource("point")&&void 0!=o.getLayer("point")&&(o.removeLayer("point"),o.removeSource("point")),t.once("idle",e=>{var o=document.createElement("div");o.innerHTML="Guess this location";var i=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=i.namespaceURI,c=document.createElementNS(a,"path");i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("viewBox","0 0 448 512"),i.setAttribute("class","chevron"),c.setAttribute("d","M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"),c.setAttribute("fill","white"),i.appendChild(c),o.append(i),o.className="marker",new mapboxgl.Marker(o).setLngLat([s,l]).addTo(t);let d=t.queryTerrainElevation([s,l]);console.log(d),d<=0?S():(r.fire(),setTimeout(()=>{g.style.display="none",R.style.visibility="visible",n.style.visibility="visible",B.style.overflow="visible",el()},1e3))})}i.style.cursor="crosshair",o.on("mousedown",e=>{i.style.cursor="grabbing"}),o.on("mouseup",e=>{i.style.cursor="crosshair"}),E.addEventListener("click",e=>{B.classList.add("guessed"),ec(),t.setMinZoom([1]),P.style.display="block",5===b?(j.style.display="none",D.style.display="block"):j.style.display="block",n.style.display="none",E.style.display="none",t.addSource("guessPoint",{type:"geojson",data:{type:"Point",coordinates:[y,$]}}),t.addLayer({id:"guessPoint",source:"guessPoint",type:"circle",paint:{"circle-radius":10,"circle-color":"#0D3C5D","circle-stroke-color":"#000023","circle-stroke-width":2}}),t.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[y,$],[s,l]]}}}),t.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"white","line-width":7}}),t.addSource("countries",{type:"vector",url:"mapbox://mapbox.country-boundaries-v1"}),t.addLayer({id:"correct-country",type:"fill",source:"countries","source-layer":"country_boundaries",paint:{"fill-color":"#28FF43","fill-opacity":.4}},"route"),t.setFilter("correct-country",["in","iso_3166_1_alpha_3",a]);let o=t.getSource("route")._options.data;console.log(o),console.log(Q),console.log(V),console.log(W);let r=turf.lineString([[y,$],[s,l]]),i=turf.point([y,$]),c=turf.booleanPointInPolygon(i,W);console.log(c);let d=turf.length(r);var u=Math.trunc(d*=1e3);d>=1e3?(d=Math.round(d/1e3*100)/100+" km",u=Math.round(u/1e3*100)/100,console.log(Math.exp(-u/2e3)),u=Math.round(u),H.value=1e3*Math.exp(-(u/2e3)),console.log(d),console.log(u)):(d=Math.round(d)+" m",console.log(d),console.log(u),H.value=1e3),H.value>999?H.classList.add("perfect"):H.classList.remove("perfect"),w.innerHTML=d,1==Math.round(H.value)?x.innerHTML=Math.round(H.value)+" pt":x.innerHTML=Math.round(H.value)+" pts";let m=new mapboxgl.LngLatBounds([y,$],[s,l]);!0==p&&(t.scrollZoom.enable(),t.dragRotate.enable(),t.dragPan.enable(),t.touchZoomRotate.enableRotation()),m.extend([y,$]),m.extend([s,l]),t.fitBounds(m,{padding:200,bearing:0,pitch:0,duration:4e3}),X+=1e3,J.innerHTML=X,K+=Math.round(H.value),O.innerHTML=K,Y[0].points.push(Math.round(H.value)),Y[1].distance.push(d),Y[2].country.push(a),Y[3].isCountryCorrect.push(c),Y[4].time.push(ey(h)+":"+ey(L)+":"+ey(f)),Y[5].mathTime.hours.push(h),Y[5].mathTime.minutes.push(L),Y[5].mathTime.seconds.push(f)}),j.addEventListener("click",e=>{A.style.display="block",B.classList.remove("guessed"),n.style.visibility="hidden",B.style.overflow="hidden",es(),ed(),r.fire(),R.style.visibility="hidden",g.style.display="block",t.removeLayer("guessPoint"),t.removeSource("guessPoint"),t.removeLayer("route"),t.removeSource("route"),P.style.display="none",j.style.display="none",n.style.display="block",S()})}function es(){b++,C.innerHTML=b,5===b&&(console.log(b),j.style.display="none")}function el(){S.style.display="block",clearInterval(k),k=setInterval(()=>{eu()},10)}function ec(){clearInterval(k)}function ed(){S.style.display="none",h=0,L=0,f=0,_=0,document.querySelector(".hour").innerText="00",document.querySelector(".minute").innerText="00",document.querySelector(".second").innerText="00"}function eu(){(_+=15)>1e3&&(_=0,f++),60==f&&(f=0,L++),60==L&&(L=0,h++),document.querySelector(".hour").innerText=ey(h),document.querySelector(".minute").innerText=ey(L),document.querySelector(".second").innerText=ey(f)}function ey(e){return e>9?e:`0${e}`}});